# Вариант 5

Дана матрица затрат для задач A, B, C, D, E и исполнителей 1, 2, 3, 4, 5:

|       | **1** | **2** | **3** | **4** | **5** |
|-------|:-----:|:-----:|:-----:|:-----:|:-----:|
| **A** |  10   |  14   |   8   |  14   |  10   |
| **B** |  14   |   8   |   6   |   7   |  12   |
| **C** |   5   |  15   |   7   |   5   |  14   |
| **D** |  12   |  10   |  11   |  11   |   9   |
| **E** |  14   |  10   |   5   |  14   |  14   |

1. Проведем редукцию матрицы по строкам.

|       | **1** | **2** | **3** | **4** | **5** | **Min** |
|-------|:-----:|:-----:|:-----:|:-----:|:-----:|:-------:|
| **A** |   2   |   6   |   0   |   6   |   2   |    8    |
| **B** |   8   |   2   |   0   |   1   |   6   |    6    |
| **C** |   0   |  10   |   2   |   0   |   9   |    5    |
| **D** |   3   |   1   |   2   |   2   |   0   |    9    |
| **E** |   9   |   5   |   0   |   9   |   9   |    5    |

Выполним редукцию матрицы по столбцам.

|         | **1** | **2** | **3** | **4** | **5** |
|---------|:-----:|:-----:|:-----:|:-----:|:-----:|
| **A**   |   2   |   5   |   0   |   6   |   2   |
| **B**   |   8   |   1   |   0   |   1   |   6   |
| **C**   |   0   |   9   |   2   |   0   |   9   |
| **D**   |   3   |   0   |   2   |   2   |   0   |
| **E**   |   9   |   4   |   0   |   9   |   9   |
| **Min** |   0   |   1   |   0   |   0   |   0   |

Итогом 1 и 2 пункта получаем редуцированную матрицу, где нули обозначают наименее затратные варианты назначений.

|       | **1** | **2** | **3** | **4** | **5** |
|-------|:-----:|:-----:|:-----:|:-----:|:-----:|
| **A** |   2   |   5   |   0   |   6   |   2   |
| **B** |   8   |   1   |   0   |   1   |   6   |
| **C** |   0   |   9   |   2   |   0   |   9   |
| **D** |   3   |   0   |   2   |   2   |   0   |
| **E** |   9   |   4   |   0   |   9   |   9   |

2. Построим двудольный граф, вынесем на него те ребра, для которых в редуцированной матрице указаны нули.

```mermaid
graph LR
    subgraph "Доля 1"
        A((A))
        B((B))
        C((C))
        D((D))
        E((E))
    end
    subgraph "Доля 2"
        1((1))
        2((2))
        3((3))
        4((4))
        5((5))
    end
    A --- 3
    B --- 3
    C --- 1
    C --- 4
    D --- 2
    D --- 5
    E --- 3
```

Выберем произвольное паросочетание $[A, 3]$, $[C, 1]$, $[D, 2]$ и попытаемся построить совершенное паросочетание с помощью чередующихся деревьев.

```mermaid
graph LR
    subgraph "Доля 1"
        A((A))
        B((B))
        C((C))
        D((D))
        E((E))
    end
    subgraph "Доля 2"
        1((1))
        2((2))
        3((3))
        4((4))
        5((5))
    end
    A === 3
    B --- 3
    C === 1
    C --- 4
    D === 2
    D --- 5
    E --- 3
    
    style A fill:#008000
    style C fill:#008000
    style D fill:#008000
    style 1 fill:#008000
    style 2 fill:#008000
    style 3 fill:#008000
```

Попытаемся построить чередующееся дерево из непокрытой вершины E.

```mermaid
graph LR
    subgraph " 0 фр."
        E((E))
    end
    subgraph " 1 фр."
        3((3))
    end
    subgraph " 2 фр."
        A((A))
    end

    E --> 3 ===> A
    
    style A fill:#008000
    style 3 fill:#008000
```

В построенном дереве нет цепей, чередующихся относительно текущего паросочетания, ветка закончилась в покрытой вершине A, которая не имеет других свободных нулевых ребер. Вращать паросочетание некуда.

3. Проведем повторную редукцию матрицы затрат.

Во множество X выпишем все **покрытые построенным деревом** вершины первой доли графа, во множество Y все **покрытые построенным деревом** вершины из второй доли графа.

$$
X = \{A, E\}
$$

$$
Y = \{3\}
$$

Необходимо найти минимальный элемент из строк, включенных во множество X и столбцов, не включенных во множество Y.

В нашем случае это будут строки A, E и столбцы 1, 2, 4, 5. Минимальный элемент 2, расположен в строке A и столбце 1. 

Вычтем 2 из всех непокрытых строк (A, E) и прибавим 2 ко всем покрытым столбцам (3).

|       | **1** | **2** | **3** | **4** | **5** |       |
|-------|:-----:|:-----:|:-----:|:-----:|:-----:|:-----:|
| **A** |   **0**   |   3   | 0 |   4   |   **0**   |  -2   |
| **B** |   8   |   1   |   2 |   1   |   6   |       |
| **C** |   0   |   9   |   4   |   0   |   9   |       |
| **D** |   3   |   0   |   4   |   2   |   0   |       |
| **E** |   7   |   2   | 0 |   7   |   7   |  -2   |
|       |       |       |  +2   |       |       |       |

**Примечание:** Дополнительно выполним редукцию по строке B (вычитание минимума 1) для упрощения матрицы. Это не является обязательным шагом стандартного венгерского алгоритма, но не нарушает его работу.

|       | **1** | **2** | **3** | **4** | **5** |
|-------|:-----:|:-----:|:-----:|:-----:|:-----:|
| **A** |   **0**   |   3   | 0 |   4   |   **0**   |
| **B** |   7   |   0   |   1 |   0   |   5   |
| **C** |   0   |   9   |   4   |   0   |   9   |
| **D** |   3   |   0   |   4   |   2   |   0   |
| **E** |   7   |   2   | 0 |   7   |   7   |

В ячейках A1, A5, B2, B4 появились новые нули.
Попробуем построить паросочетание. Добавим соответствующие ребра в двудольный граф.

```mermaid
graph LR
    subgraph "Доля 1"
        A((A))
        B((B))
        C((C))
        D((D))
        E((E))
    end
    subgraph "Доля 2"
        1((1))
        2((2))
        3((3))
        4((4))
        5((5))
    end

    A --- 1
    A === 3
    A --- 5

    B --- 2
    B --- 4

    C === 1
    C --- 4
    
    D === 2
    D --- 5
    
    E --- 3

    style A fill:#008000
    style C fill:#008000
    style D fill:#008000
    style 1 fill:#008000
    style 2 fill:#008000
    style 3 fill:#008000
    
```

4. Попытаемся построить совершенное паросочетание с помощью чередующихся деревьев.

```mermaid
graph LR
    subgraph " 0 фр."
        E((E))
    end
    subgraph " 1 фр."
        3((3))
    end
    subgraph " 2 фр."
        A((A))
    end
    subgraph " 3 фр."
        1.1((1))
        5.1((5))
    end
    
    E --> 3 ==> A
    A --> 1.1 
    A --> 5.1

    style 3 fill:#008000
    style A fill:#008000
    style 1.1 fill:#008000

```

Построенное дерево содержит цепь, чередующиеся относительно текущего паросочетания. Цепь начинается и заканчивается в непокрытых вершинах, все ребра в цепи чередуются по вхождению в текущее паросочетание.

```mermaid
graph LR
    A((A))
    E((E))
    3((3))
    5((5))
    
    E --> 3 ==> A --> 5 

    style 3 fill:#008000
    style A fill:#008000
```

"Перекрасим" найденную цепь и проверим полученные паросочетания.

```mermaid
graph LR
    A((A))
    E((E))
    3((3))
    5((5))
    
    E ==> 3 --> A ==> 5 

    style A fill:#008000
    style E fill:#008000
    style 3 fill:#008000
    style 5 fill:#008000
```

```mermaid
graph LR
    subgraph "Доля 1"
        A((A))
        B((B))
        C((C))
        D((D))
        E((E))
    end
    subgraph "Доля 2"
        1((1))
        2((2))
        3((3))
        4((4))
        5((5))
    end

    A --- 1
    A --- 3
    A === 5

    B --- 2
    B --- 4

    C === 1
    C --- 4
    
    D === 2
    D --- 5
    
    E === 3

    style E fill:#008000
    style A fill:#008000
    style C fill:#008000
    style D fill:#008000
    style 1 fill:#008000
    style 2 fill:#008000
    style 3 fill:#008000
    style 5 fill:#008000
    
```

На данном этапе остается не покрыта точка B, ее и берем для 0 фр.

```mermaid
graph LR
    subgraph " 0 фр."
        B((B))
    end
    subgraph " 1 фр."
        2((2))
        4((4))
    end
    subgraph " 2 фр."
        D((D))
    end
    subgraph " 3 фр."
        5((5))
    end
    subgraph " 4 фр."
        A((A))
    end
    subgraph " 5 фр."
        1((1))
    end
    subgraph " 6 фр."
        C((C))
    end
    
    B --> 2 
    B --> 4
    2 ==> D --> 5 ==> A --> 1 ==> C

    style D fill:#008000
    style 2 fill:#008000
    style 5 fill:#008000
    style A fill:#008000
    style 1 fill:#008000
    style C fill:#008000
```

Построенное дерево содержит чередующуюся цепь B-2-D-5-A-1-C. Цепь начинается в непокрытой вершине B и заканчивается в вершине C, которая после удаления ребра C1 становится непокрытой.

"Перекрасим" найденную цепь:

```mermaid
graph LR
    B((B))
    D((D))
    A((A))
    C((C))
    2((2))
    5((5))
    1((1))
    
    B ==> 2 --> D ==> 5 --> A ==> 1 --> C

    style B fill:#008000
    style D fill:#008000
    style A fill:#008000
    style C fill:#008000
    style 2 fill:#008000
    style 5 fill:#008000
    style 1 fill:#008000
```

После увеличения паросочетания по этой цепи получаем: B2, D5, A1, E3. Вершина C остается непокрытой, но в редуцированной матрице есть нулевое ребро C4, и вершина 4 не покрыта (B соединена с 2, а не с 4). Добавим ребро C4 напрямую в паросочетание.

Итоговое совершенное паросочетание: A1, B2, C4, D5, E3.

```mermaid
graph LR
    subgraph "Доля 1"
        A((A))
        B((B))
        C((C))
        D((D))
        E((E))
    end
    subgraph "Доля 2"
        1((1))
        2((2))
        3((3))
        4((4))
        5((5))
    end

    A === 1
    B === 2
    C === 4
    D === 5
    E === 3

    style A fill:#008000
    style B fill:#008000
    style C fill:#008000
    style D fill:#008000
    style E fill:#008000
    style 1 fill:#008000
    style 2 fill:#008000
    style 3 fill:#008000
    style 4 fill:#008000
    style 5 fill:#008000
```

| Задача | Исполнитель | Стоимость |
| --- | --- | --- |
| A | 1 | 10 |
| B | 2 | 8 |
| C | 4 | 5 |
| D | 5 | 9 |
| E | 3 | 5 |

Общая стоимость: 10 + 8 + 5 + 9 + 5 = 37

## Ответ
Минимальная стоимость затрат **37**, при следующих назначениях:
- задача A → исполнитель 1 (стоимость 10)
- задача B → исполнитель 2 (стоимость 8)
- задача C → исполнитель 4 (стоимость 5)
- задача D → исполнитель 5 (стоимость 9)
- задача E → исполнитель 3 (стоимость 5)

**Проверка:** Все назначения соответствуют нулевым элементам в финальной редуцированной матрице, что гарантирует оптимальность решения.
